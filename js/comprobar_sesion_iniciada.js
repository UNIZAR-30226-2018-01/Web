function playMusic(e,t,o,n,a,i,r){audio_core=$("#audio-player").attr("src",e)[0],document.getElementById("imagen_cancion_wrapper").src=t,document.getElementById("cancion_wrapper").innerHTML=o;var s="cancion.html?nombre="+o+"&artista="+n+"&album="+a+"&genero="+r+"&uploader="+i+"&ruta="+e+"&ruta_imagen="+t;document.getElementById("enlacecancion_wrapper").href=s,document.getElementById("imagen_cancion_wrapper").onclick=function(){setIndiceAndPlay(0,1)},document.getElementById("cancion_wrapper").onclick=function(){setIndiceAndPlay(0,1)},audio_core.play()}function reloadMusic(){var e=document.getElementById("audio-player").src;audio_core=$("#audio-player").attr("src",e)[0],audio_core.play()}function reproducirCancion(e){var t=sessionStorage.getItem("listaActual");if(null==t)cargar_lista_top_semanal();else{var o=JSON.parse(t),n=sessionStorage.getItem("indiceLista"),a=o[n].tituloCancion,i=o[n].nombreArtista,r=o[n].genero,s=o[n].nombreAlbum,l=o[n].ruta,c=l.indexOf("/ps"),u=".."+l.substr(c),d=o[n].uploader;avisarReproducirCancion(l);var m=o[n].ruta_imagen,g=m.indexOf("/ps"),p=".."+m.substr(g);0==e?playMusic(u,p,a,i,s,d,r):(sessionStorage.setItem("tiempo_cancion",0),window.location="cancion.html?nombre="+a+"&artista="+i+"&album="+s+"&genero="+r+"&uploader="+d+"&ruta="+u+"&ruta_imagen="+p)}}function avisarReproducirCancion(e){var t="ruta="+e;$.ajax({url:"/ps/ReproducirCancion",type:"post",data:t}).done(function(e){}).fail(function(e){alert("Error interno. Inténtelo más tarde.")})}function siguienteCancion(e){var t=JSON.parse(sessionStorage.getItem("listaActual")),o=parseInt(sessionStorage.getItem("indiceLista")),n=sessionStorage.getItem("valor_aleatorio");null!=n&&1==n?o=getRandomInt(0,t.length):(o+=1)==t.length&&(o=0),sessionStorage.setItem("indiceLista",o),reproducirCancion(e)}function anteriorCancion(e){var t=JSON.parse(sessionStorage.getItem("listaActual")),o=parseInt(sessionStorage.getItem("indiceLista")),n=sessionStorage.getItem("valor_aleatorio");null!=n&&1==n?o=getRandomInt(0,t.length):(o-=1)<0&&(o=t.length-1),sessionStorage.setItem("indiceLista",o),reproducirCancion(e)}function setIndiceAndPlay(e,t){sessionStorage.setItem("indiceLista",e);var o=sessionStorage.getItem("listaActual"),n=sessionStorage.getItem("listaAux");o!=n&&sessionStorage.setItem("listaActual",n),reproducirCancion(t)}function setIndiceAndPlayRecientes(e,t,o){var n;sessionStorage.setItem("indiceLista",e),n=1==o?sessionStorage.getItem("listaRecientes"):sessionStorage.getItem("listaRecomendadas"),sessionStorage.getItem("listaActual")!=n&&sessionStorage.setItem("listaActual",n),reproducirCancion(t)}function finCancion(){var e=window.location.href,t=0;e.indexOf("cancion.html?")>=0&&(t=1),window.setTimeout(function(){siguienteCancion(t)},100)}function pulsadoAleatorio(){document.getElementById("valor_aleatorio").checked?sessionStorage.setItem("valor_aleatorio",1):sessionStorage.setItem("valor_aleatorio",0)}function getRandomInt(e,t){return Math.floor(Math.random()*(t-e))+e}function cargar_lista_top_semanal(){$.ajax({url:"/ps/TopSemanal",type:"post"}).done(function(e){var t=JSON.parse(e);if(null!=t.error)t.error.indexOf("Usuario no logeado en el servidor")>=0&&(borrarCookie("login"),borrarCookie("idSesion"),window.location="inicio.html");else if(null!=t.NoHayCanciones)alert("Top semanal no tiene canciones.");else{var o=t.canciones;if(o.length>0){var n=JSON.stringify(o);sessionStorage.setItem("listaActual",n),sessionStorage.setItem("indiceLista",0);var a=0;window.location.href.indexOf("cancion.html?")>=0&&(a=1),reproducirCancion(a)}}}).fail(function(e){alert("Error interno. Inténtelo más tarde.")})}function form_repr_lista(){$(".form_reproducir_lista").submit(function(e){e.preventDefault();var t=$(this).attr("action"),o=$(this).serialize(),n=$(this).attr("method");$.ajax({url:t,type:n,data:o}).done(function(e){var t=JSON.parse(e);if(null!=t.error)t.error.indexOf("Usuario no logeado en el servidor")>=0&&(borrarCookie("login"),borrarCookie("idSesion"),window.location="inicio.html");else if(null!=t.NoHayCanciones)alert("La lista no tiene canciones.");else{var o=JSON.stringify(t.canciones);sessionStorage.setItem("listaActual",o),sessionStorage.setItem("indiceLista",0),reproducirCancion(0)}}).fail(function(e){alert("Error interno. Inténtelo más tarde.")})})}function setLista(e){var t;t=0==e?sessionStorage.getItem("listaRecientes"):sessionStorage.getItem("listaRecomendaciones"),sessionStorage.setItem("listaAux",t)}function cargar_lista_favoritos(){var e="nombreLista=Favoritos&nombreCreadorLista="+leerCookie("login");return $.ajax({url:"/ps/VerLista",type:"post",data:e})}null!=leerCookie("login")&&null!=leerCookie("idSesion")||(window.location="inicio.html"),$(function(){$("#audio-player").mediaelementplayer({alwaysShowControls:!0,features:["playpause","progress","volume","duration"],audioVolume:"horizontal",iPadUseNativeControls:!0,iPhoneUseNativeControls:!0,AndroidUseNativeControls:!0,success:function(e,t,o){var n=sessionStorage.getItem("tiempo_cancion");null==n&&(n=0),o.setCurrentTime(n),setTimeout(function e(){sessionStorage.setItem("tiempo_cancion",o.getCurrentTime()),setTimeout(e,500)},500)}})}),$(document).ready(function(){var e=sessionStorage.getItem("valor_aleatorio");e=null!=e&&0!=e,document.getElementById("valor_aleatorio").checked=e;var t=0;window.location.href.indexOf("cancion.html?")>=0?t=1:reproducirCancion(t)});

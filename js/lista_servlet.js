function updateQueryStringParam(e,r){baseUrl=[location.protocol,"//",location.host,location.pathname].join(""),urlQueryString=document.location.search;var a=e+"="+r,t="?"+a;urlQueryString&&(keyRegex=new RegExp("([?&])"+e+"[^&]*"),t=null!==urlQueryString.match(keyRegex)?urlQueryString.replace(keyRegex,"$1"+a):urlQueryString+"&"+a),window.history.replaceState({},"",baseUrl+t)}function form_borrar_cancion(){$(".form_borrar_cancion_lista").submit(function(e){e.preventDefault();var r=$(this).attr("action"),a=$(this).serialize(),t=$(this).attr("method");$.ajax({url:r,type:t,data:a}).done(function(e){var r=JSON.parse(e);null!=r.error?r.error.indexOf("Usuario no logeado en el servidor")>=0?(borrarCookie("login"),borrarCookie("idSesion"),window.location="inicio.html"):alert("Error interno. Inténtelo más tarde."):($("#resultado_seguir").text("Canción eliminada correctamente."),$("#result_seguir").attr("src","img/exito.png")),$(".button2").click()}).fail(function(e){alert("Error interno. Inténtelo más tarde.")})})}$(document).ready(function(){var e=window.location.href,r=new URL(e),a=r.searchParams.get("lista"),t=r.searchParams.get("autor");document.title="Lista "+a+" de "+t,null!=a&&null!=t||(window.location="home.html"),$("#prueba").append(a),$("#form_mostrar_lista").submit(function(e){e.preventDefault();var r=window.location.href,a=new URL(r),t=a.searchParams.get("lista"),n=a.searchParams.get("autor");document.getElementById("form_mostrar_lista").elements[0].value=t,document.getElementById("form_mostrar_lista").elements[1].value=n;var o=$(this).attr("action"),s=$(this).serialize(),l=$(this).attr("method");$.ajax({url:o,type:l,data:s}).done(function(e){var r=JSON.parse(e);if(null!=r.error)r.error.indexOf("Usuario no logeado en el servidor")>=0&&(borrarCookie("login"),borrarCookie("idSesion"),window.location="inicio.html");else if(null!=r.NoHayCanciones){var a=window.location.href,n=(o=new URL(a)).searchParams.get("autor");leerCookie("login")==n&&($(".editar_lista").css("display","block"),$(".anadir_lista").css("display","block")),$("#separador").after('<h2 id="sin_resul">No hay canciones.</h2>')}else{a=window.location.href;var o,s=(o=new URL(a)).searchParams.get("pagina"),l=(n=o.searchParams.get("autor"),0);leerCookie("login")==n&&($(".editar_lista").css("display","block"),$(".anadir_lista").css("display","block"),l=1);var c=r.canciones,u=JSON.stringify(c);sessionStorage.setItem("listaAux",u),s=null==s?1:parseInt(s);for(inicio=4*(s-1),i=inicio;i<4+inicio&&i<c.length;i++){var d=c[i].tituloCancion,m=c[i].nombreArtista,p=c[i].genero,g=c[i].nombreAlbum,f=c[i].ruta,h=f.indexOf("/ps"),b=".."+f.substr(h),_=c[i].uploader,v=c[i].ruta_imagen,y=v.indexOf("/ps"),w=".."+v.substr(y);null==p&&(p=""),null==g&&(g="");var x='<div class="cancioninf"><ul><li id="barraopciones"><a href="cancion.html?nombre='+d+"&artista="+m+"&album="+g+"&genero="+p+"&uploader="+_+"&ruta="+b+"&ruta_imagen="+w+'" id="enlacecancion"><div class="imagen"><img src="'+w+'" alt="Imagen cancion" onClick="setIndiceAndPlay('+i+',1)" onerror="this.src=\'img/Unknown_Music.png\'"></div></a></li>',I='<li id="barraopciones"><a href="cancion.html?nombre='+d+"&artista="+m+"&album="+g+"&genero="+p+"&uploader="+_+"&ruta="+b+"&ruta_imagen="+w+'" id="enlacecancion"><div class="nombrecancion" onClick="setIndiceAndPlay('+i+',1)">'+d+"</div></a>",k='<a href="artista.html?artista='+m+'"><div class="nombreautor">Artista: '+m+"</div></a>",S='<a href="estilo.html?estilo='+p+'"><div class="nombregenero">Género: '+p+"</div></a>",E='</li><li id="barraopciones"><div class="simb_repr_play"><input type="image" src="img/play.png" alt="Reproducir cancion" title="Reproducir canción" onClick="setIndiceAndPlay('+i+',0);return false;"></div></li>',C='<form class="form_borrar_cancion_lista" method="post" action="/ps/QuitarCancionDeLista"><li id="barraopciones"><div class="simb_repr_elim"><input type="hidden" name="ruta" value="'+f+'"/><input type="hidden" name="nombreLista" value="'+t+'"/><input type="image" src="img/eliminar.png" alt="Eliminar cancion de lista" title="Eliminar canción de lista"></div></li></form>';""==p&&(S=""),1==l?$(".informacion").append(x+I+k+S+E+C+"</ul></div>"):$(".informacion").append(x+I+k+S+E+"</ul></div>")}if(4+inicio<c.length){var O='<br><br><form action="lista.html"><button type="submit" id="boton_mostrar_mas" class="aumentar">Mostrar más</button><input type="hidden" name="lista" value="'+t+'"/><input type="hidden" name="autor" value="'+n+'"/><input type="hidden" name="pagina" value="'+(s+1)+'"/></form>';$(".informacion").append(O)}}form_borrar_cancion()}).fail(function(e){alert("Error interno. Inténtelo más tarde.")})}),$("#form_mostrar_lista").submit(),$("#form_buscar_lista").submit(function(e){e.preventDefault();var r=document.getElementById("form_buscar_lista").elements[0].value,a=$.trim(r);if(document.getElementById("search_lista").value=a,""==a)return!1;var t=$(this).attr("action"),i=$(this).serialize(),n=$(this).attr("method");$.ajax({url:t,type:n,data:i}).done(function(e){var r=JSON.parse(e),t=JSON.stringify(e);null!=r.error?r.error.indexOf("Usuario no logeado en el servidor")>=0?(borrarCookie("login"),borrarCookie("idSesion"),window.location="inicio.html"):r.error.indexOf("lista cuyo nombre coincida")>=0?(sessionStorage.setItem("lista_listas",t),window.location="busqueda_listas.html?busqueda_lista="+a+"&pagina=1"):alert("Error. Inténtelo más tarde."):(sessionStorage.setItem("lista_listas",t),window.location="busqueda_listas.html?busqueda_lista="+a+"&pagina=1")}).fail(function(e){alert("Error interno. Inténtelo más tarde.")})}),$("#form_cambiar_nombre_lista").submit(function(e){e.preventDefault();var r=document.getElementById("form_cambiar_nombre_lista").elements[1].value,a=$.trim(r);if(document.getElementById("IdUsar1").value=a,""==a)return!1;var t=window.location.href,i=new URL(t).searchParams.get("lista");document.getElementById("viejoNombre").value=i;var n=$(this).attr("action"),o=$(this).serialize(),s=$(this).attr("method");$.ajax({url:n,type:s,data:o}).done(function(e){var r=JSON.parse(e);null!=r.error?r.error.indexOf("Usuario no logeado en el servidor")>=0?(borrarCookie("login"),borrarCookie("idSesion"),window.location="inicio.html"):($("#resultado_seguir").text("Ya existe la lista "+a+"."),$("#result_seguir").attr("src","img/error.png")):($("#resultado_seguir").text("El nombre de la lista se ha cambiado correctamente."),$("#result_seguir").attr("src","img/exito.png"),updateQueryStringParam("lista",a)),$(".button2").click()}).fail(function(e){alert("Error interno. Inténtelo más tarde.")})}),$("#form_subir_musica").submit(function(e){e.preventDefault();var r=window.location.href,a=new URL(r).searchParams.get("lista");document.getElementById("nombre_lista").value=a;var t=$(this).attr("action"),i=new FormData(document.getElementById("form_subir_musica")),n=$(this).attr("method");$.ajax({url:t,type:n,data:i,dataType:"html",cache:!1,contentType:!1,processData:!1,xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var r=e.loaded/e.total;r=parseInt(100*r),$(".myprogress").text(r+"%"),$(".myprogress").css("width",r+"%")}},!1),e}}).done(function(e){}).done(function(e){for(var r=e.indexOf("\n"),a=e,t=0;r>=0;){var i=JSON.parse(a.substr(0,r)).error;null!=i&&($("#resultado_seguir").append("-"+i),$("#resultado_seguir").append("<br>"),t=1),r=(a=a.substr(r+1)).indexOf("\n")}0==t?($("#resultado_seguir").text("Canciones subidas correctamente."),$("#result_seguir").attr("src","img/exito.png")):($(".window-container2").width(800),$("#result_seguir").attr("src","img/error.png")),$(".button2").click()}).fail(function(e){alert("Error interno. Inténtelo más tarde.")})})});

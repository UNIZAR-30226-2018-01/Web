function form_mostrar_anadir_alistas(){$(".boton_mostrar_listas").click(function(a){a.preventDefault();var r=$(this).parent().parent().parent().parent(),e=r.attr("action"),n=r.serialize(),t=r.attr("method"),o=$(this).parent().children().get(1).value;$.ajax({url:e,type:t,data:n}).done(function(a){var r=JSON.parse(a);if(null!=r.error)r.error.indexOf("Usuario no logeado en el servidor")>=0?(borrarCookie("login"),borrarCookie("idSesion"),window.location="inicio.html"):$(".close11").after('<h2 id="sin_resul">No hay listas.</h2>');else{var e=r.nombre,n=1;for(i=0;i<e.length;i++){var t=e[i];if("Favoritos"!=t){var s='<form class="form_anadir_cancion_lista" action="/ps/AnyadirCancionALista" method="post"><div class="nombrelista"><input type="submit" class="anadir_cancion_lista_f" value="'+t+'"><input type="hidden" name="nombreLista" value="'+t+'"><input type="hidden" name="ruta" value="'+o+'"/></div></form>';$(".ventana_listas").append(s),n=0}}1!=n||$("#sin_resul")[0]||$(".close11").after('<h2 id="sin_resul">No hay listas.</h2>'),form_anadir_cancion_a_lista()}$(".button11").click()}).fail(function(i){alert("Error interno. Inténtelo más tarde.")})})}function form_anadir_cancion_a_lista(){$(".form_anadir_cancion_lista").submit(function(i){i.preventDefault();var a=$(this).attr("action"),r=$(this).serialize(),e=$(this).attr("method");$.ajax({url:a,type:e,data:r}).done(function(i){var a=JSON.parse(i);null!=a.error?a.error.indexOf("Usuario no logeado en el servidor")>=0?(borrarCookie("login"),borrarCookie("idSesion"),window.location="inicio.html"):(alert("Error. Inténtelo más tarde."),s):a.CancionYaExisteEnLista?($("#resultado_seguir").text("La canción ya existe en la lista."),$("#result_seguir").attr("src","img/error.png")):($("#resultado_seguir").text("Canción añadida a la lista."),$("#result_seguir").attr("src","img/exito.png")),$(".button10").click()}).fail(function(i){alert("Error interno. Inténtelo más tarde.")})})}function form_anadirquitar_cancion_a_favorito(){$(".form_poner_favorito").submit(function(i){i.preventDefault();var a=$(this).attr("action"),r=$(this).serialize(),e=$(this).attr("method");$.ajax({url:a,type:e,data:r}).done(function(i){var a=JSON.parse(i);null!=a.error?a.error.indexOf("Usuario no logeado en el servidor")>=0?(borrarCookie("login"),borrarCookie("idSesion"),window.location="inicio.html"):(alert("Error. Inténtelo más tarde."),s):(a.CancionYaExisteEnLista,location.reload())}).fail(function(i){alert("Error interno. Inténtelo más tarde.")})}),$(".form_quitar_favorito").submit(function(i){i.preventDefault();var a=$(this).attr("action"),r=$(this).serialize(),e=$(this).attr("method");$.ajax({url:a,type:e,data:r}).done(function(i){var a=JSON.parse(i);null!=a.error?a.error.indexOf("Usuario no logeado en el servidor")>=0?(borrarCookie("login"),borrarCookie("idSesion"),window.location="inicio.html"):(alert("Error. Inténtelo más tarde."),s):(a.CancionYaExisteEnLista,location.reload())}).fail(function(i){alert("Error interno. Inténtelo más tarde.")})})}function mostrarPaginaconFav(a,r,e,n){var t=window.location.href,o=new URL(t),s=o.searchParams.get("pagina"),l=o.searchParams.get(n),c=a.canciones,d=JSON.stringify(c);".menurecientes"==n?sessionStorage.setItem("listaRecientes",d):".menuestilo"==n?sessionStorage.setItem("listaRecomendadas",d):sessionStorage.setItem("listaAux",d);var m=r;s=null==s?1:parseInt(s);var u=5;for(".menurecientes"==n&&(u=10),inicio=(s-1)*u,i=inicio;i<u+inicio&&i<c.length;i++){var p,f,_,v,g,h=c[i].tituloCancion,b=c[i].nombreArtista,y=c[i].genero,C=c[i].nombreAlbum,I=c[i].ruta,x=I.indexOf("/ps"),k=".."+I.substr(x),A=c[i].uploader,S=c[i].ruta_imagen,E=S.indexOf("/ps"),w=".."+S.substr(E);null==y&&(y=""),null==C&&(C=""),1==(null!=m&&m.includes(JSON.stringify(c[i])))?(p="QuitarCancionDeLista",f="favanadido.png",_="Quitar de favoritos",v="form_quitar_favorito"):(p="AnyadirCancionALista",f="favoritos.png",_="Añadir a favoritos",v="form_poner_favorito"),g=".menurecientes"==n?"setIndiceAndPlayRecientes("+i+",0,1);":".menuestilo"==n?"setIndiceAndPlayRecientes("+i+",0,0);":"setIndiceAndPlay("+i+",0);";var O='<div class="cancioninf"><ul><li id="barraopciones"><a href="cancion.html?nombre='+h+"&artista="+b+"&album="+C+"&genero="+y+"&uploader="+A+"&ruta="+k+"&ruta_imagen="+w+'" id="enlacecancion"><div class="imagen"><img src="'+w+'" alt="Imagen cancion" onClick="setIndiceAndPlay('+i+',1)" onerror="this.src=\'img/Unknown_Music.png\'"></div></a></li>',L='<li id="barraopciones"><a href="cancion.html?nombre='+h+"&artista="+b+"&album="+C+"&genero="+y+"&uploader="+A+"&ruta="+k+"&ruta_imagen="+w+'" id="enlacecancion"><div class="nombrecancion" onClick="setIndiceAndPlay('+i+',1)">'+h+'</div></a><a href="artista.html?artista='+b+'" id="enlacecancion"><div class="nombreautor">Artista: '+b+"</div></a></li>",R='<li id="barraopciones"><div class="simb_repr_play"><input type="image" src="img/play.png" alt="Reproducir cancion" title="Reproducir canción" onClick="'+g+'return false;"></div></li>',N='<form class="'+v+'" method="post" action="/ps/'+p+'"><li id="barraopciones"><div class="simb_repr_fav"><input type="image" src="img/'+f+'" alt="'+_+'" title="'+_+'"></div><input type="hidden" name="ruta" value="'+I+'"/><input type="hidden" name="nombreLista" value="Favoritos"/></li></form>',P='<form class="form_mostrar_listas_c" method="post" action="/ps/MostrarListasReproduccion"><li id="barraopciones"><div class="simb_repr_lista"><div class="simb_repr_lista"><input type="hidden" id="user" name="user" value="'+leerCookie("login")+'"><input type="hidden" name="ruta" value="'+I+'"/><input type="image" src="img/listas_add.png" alt="Añadir a lista" class="boton_mostrar_listas" title="Añadir a lista"></div></div></li></form>',F=".informacion";"recientes"==e&&(F=n),$(F).append(O+L+R+N+P+"</ul></div>")}if(u+inicio<c.length){var J="";"estilo"==e&&(J='<input type="hidden" name="estilo" value="'+l+'"/>');var U='<br><br><form action="'+e+'.html"><button type="submit" id="boton_mostrar_mas" class="aumentar">Mostrar más</button>'+J+'<input type="hidden" name="pagina" value="'+(s+1)+'"/></form>',q=".informacion";"recientes"==e&&(q=n),$(q).append(U)}".menurecientes"==n?(sessionStorage.setItem("cargados_Form_Recientes",1),form_mostrar_anadir_alistas(),form_anadirquitar_cancion_a_favorito()):".menuestilo"==n&&1==sessionStorage.getItem("cargados_Form_Recientes")?sessionStorage.removeItem("cargados_Form_Recientes"):(form_mostrar_anadir_alistas(),form_anadirquitar_cancion_a_favorito())}

function form_mostrar_amigos(){$(".form_compartir_cancion").submit(function(e){e.preventDefault();var t=$(this).attr("action"),r=$(this).serialize(),o=$(this).attr("method"),a=(r.slice(14),r.indexOf("usuarioDestino=")+"usuarioDestino=".length),i=r.substr(a);$.ajax({url:t,type:o,data:r}).done(function(e){var t=JSON.parse(e);null!=t.error?t.error.indexOf("Usuario no logeado en el servidor")>=0?(borrarCookie("login"),borrarCookie("idSesion"),window.location="inicio.html"):t.error.indexOf("Duplicate entry")>=0?($(".close0").click(),$("#resultado_seguir").text("Ya has compartido la canción con "+i+"."),$("#result_seguir").attr("src","img/error.png")):alert("Error interno. Inténtelo más tarde."):($(".close0").click(),$("#resultado_seguir").text("Canción compartida con "+i+"."),$("#result_seguir").attr("src","img/exito.png")),$(".button10").click()}).fail(function(e){alert("Error interno. Inténtelo más tarde.")})})}function mostrarCancionconFav(e,t,r,o,a,n){var s=n,l=0;if(a=a.substr(2),null!=s)for(i in s=JSON.parse(s))if(t==s[i].nombreArtista&&e==s[i].tituloCancion&&r==s[i].nombreAlbum&&s[i].ruta.indexOf(a)>=0&&(o==s[i].genero||""==o||null==o)){l=1;break}1==l&&(document.getElementById("imagen_fav").src="img/favanadido.png",document.getElementById("imagen_fav").alt="Quitar de favoritos",document.getElementById("imagen_fav").title="Quitar de favoritos",document.getElementById("form_poner_fav").class="form_quitar_favorito",document.getElementById("form_poner_fav").action="/ps/QuitarCancionDeLista"),form_anadirquitar_cancion_a_favorito()}$(document).ready(function(){var e=window.location.href,t=new URL(e),r=t.searchParams.get("nombre"),o=t.searchParams.get("artista"),a=t.searchParams.get("album"),n=t.searchParams.get("genero"),s=t.searchParams.get("uploader"),l=t.searchParams.get("ruta"),c=t.searchParams.get("ruta_imagen");null!=r&&null!=o&&null!=a&&null!=n&&null!=s&&null!=l&&null!=c||(window.location="home.html"),$("meta[property='og\\:title']").attr("content","Cancion "+r+" de "+o),document.title="Cancion "+r+" de "+o,audio_core=$("#audio-player").attr("src",l)[0],document.getElementById("imagen_cancion_wrapper").src=c,document.getElementById("nombrecancion").innerHTML=r,document.getElementById("autor1").innerHTML=o;var u="artista.html?artista="+o;document.getElementById("enlacecancion_wrapper").href=u;var m="/usr/local/apache-tomcat-9.0.7/webapps"+l.substr(2);document.getElementById("rutafav").value=m,window.setTimeout(function(){reloadMusic()},100),$("#compartir_facebook").attr("href","http://www.facebook.com/sharer.php?u="+e),$("#compartir_twitter").attr("data-text","Canción: "+r+"\nArtista: "+o+"\n"),$("#compartir_twitter").attr("data-url",e),document.getElementById("botonlista_user").value=leerCookie("login"),document.getElementById("botonlista_ruta").value=m,cargar_lista_favoritos().done(function(e){var t=JSON.parse(e),s=void 0;if(null!=t.error)t.error.indexOf("Usuario no logeado en el servidor")>=0&&(borrarCookie("login"),borrarCookie("idSesion"),window.location="inicio.html");else if(null!=t.NoHayCanciones);else{var c=t.canciones;if(c.length>0){for(i in c)delete c[i].uploader;s=JSON.stringify(c)}}mostrarCancionconFav(r,o,a,n,l,s)}).fail(function(e){alert("Error interno. Inténtelo más tarde."),sessionStorage.setItem("listaFavoritos",void 0)}),$("#form_mostrar_amigos").submit(function(e){e.preventDefault();var t=$(this).attr("action"),r=$(this).serialize(),o=$(this).attr("method");$.ajax({url:t,type:o,data:r}).done(function(e){var t=JSON.parse(e);if(null!=t.error)t.error.indexOf("Usuario no logeado en el servidor")>=0&&(borrarCookie("login"),borrarCookie("idSesion"),window.location="inicio.html");else if(null!=t.SinSeguidos)null==document.getElementById("sin_resul")&&$("#subir_cancion_titulo").after('<h2 id="sin_resul">No hay amigos.</h2>'),$(".button0").click();else{var r=t.listaDeSeguidos;for(i=0;i<r.length;i++){var o=r[i].nombreSeguido,a='<form class="form_compartir_cancion" method="post" action="/ps/CompartirCancion"><tr ><div class="imagen"><img src="'+("../ps/images/"+o+".jpg")+'" alt="Imagen usuario" onerror="this.src=\'img/user.png\'"></div><input type="submit" class="nombreamigo" value="'+o+'"/><input type="hidden" name="ruta" value="'+m+'"/><input type="hidden" name="usuarioDestino" value="'+o+'"/></tr></form>';$("#lista_amigos").append(a)}form_mostrar_amigos(),$(".button0").click()}}).fail(function(e){alert("Error interno. Inténtelo más tarde.")})}),form_mostrar_anadir_alistas()});
